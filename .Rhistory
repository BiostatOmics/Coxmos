x.names <- cut(x = df.times$times, breaks = breaks, include.lowest = T)
breaks_size
breaks
x.names
roundTo <- max(df.times$times)
roundTo
roundTo <- max(df.times$times) / max.breaks
roundTo
max(df.times$times) / max.breaks
max(df.times$times) / max.breaks / 1
1 / (max(df.times$times) / max.breaks)
10 / (max(df.times$times) / max.breaks)
max(df.times$times) / max.breaks
ggp_density.event$plot
roundTo = 0
if(roundTo == 0){
#select the decimals of Y
if(length(grep("\\.", df.times$times))>0){
roundTo = 1*10^-(nchar(gsub("\\.", "", as.character(Y$time[[1]])))-1)
}else{
roundTo = 0.1
}
roundTo
f.times$times
df.times$times
length(grep("\\.", df.times$times))>0
roundTo = 0
max.breaks = 10
if(roundTo == 0){
#select the decimals of Y
if(length(grep("\\.", df.times$times))>0){
roundTo = 1*10^-(nchar(gsub("\\.", "", as.character(max(Y$time)/max.breaks)))-1)
}else{
roundTo = 0.1
}
roundTo
gsub("\\.", "", as.character(max(Y$time)/max.breaks)))
gsub("\\.", "", as.character(max(Y$time)/max.breaks))
max(Y$time)/max.breaks
gsub("\\.", "", as.character(max(Y$time)/max.breaks))
max(Y$time)/max.breaks
as.character(min(Y$time)/max.breaks)
gsub("\\.", "", as.character(min(Y$time)/max.breaks))
ch <- gsub("\\.", "", as.character(min(Y$time)/max.breaks))
ch
cont = 0
ch <- gsub("\\.", "", as.character(min(Y$time)/max.breaks))
cont = 0
for(c in ch){
if(c == "0"){
cont = cont + 1
}else{
break
}
cont
c
ch
ch <- gsub("\\.", "", as.character(min(Y$time)/max.breaks))
cont = 0
for(c in 1:nchar(ch)){
if(ch[[c]] == "0"){
cont = cont + 1
}else{
break
}
cont
c
ch
ch[[1]]
ch[1]
ch[1]1:nchar(ch)
1:nchar(ch)
ch
ch[[1]][[1]]
ch[[1]][[2]]
ch[[1]][2]
ch[[2]]
ch[2]
ch[1]
class(ch)
ch
ch[1]
ch[2]
ch[1][1]
ch[1][1][1]
substr(ch,c,c+1)
c
ch <- gsub("\\.", "", as.character(min(Y$time)/max.breaks))
cont = 0
for(c in 1:nchar(ch)){
if(substr(ch,c,c) == "0"){
cont = cont + 1
}else{
break
}
cont
ch
min(Y$time)/max.breaks
roundTo = 0
max.breaks = 10
if(roundTo == 0){
#select the decimals of Y
if(length(grep("\\.", df.times$times))>0){
ch <- gsub("\\.", "", as.character(min(Y$time)/max.breaks))
cont = 0
for(c in 1:nchar(ch)){
if(substr(ch,c,c) == "0"){
cont = cont + 1
}else{
break
}
roundTo = 1*10^-cont
}else{
roundTo = 0.1
}
roundTo
breaks_size = round2any((max(df.times$times) - min(df.times$times)) / (max.breaks+1), roundTo, f = ceiling)
breaks = seq(min(df.times$times), max(df.times$times)+breaks_size, by=breaks_size)
breaks_size
breaks
max.breaks
breaks_size = round2any(max(df.times$times) / (max.breaks+1), roundTo, f = ceiling)
breaks_size
roundTo
max(df.times$times)
breaks_size = round2any(max(df.times$times), roundTo, f = ceiling)
breaks_size
breaks = seq(min(df.times$times), max(df.times$times)+breaks_size, by=breaks_size)
breaks = round2any(breaks, roundTo)
breaks
breaks = seq(min(df.times$times), max(df.times$times)+breaks_size, by=breaks_size)
breaks
breaks_size
roundTo
breaks_size
breaks_size = round2any(max(df.times$times), roundTo, f = ceiling) / max.breaks
breaks = seq(0, max(df.times$times), by=breaks_size)
breaks
max(df.times$times)
breaks_size
breaks = seq(0, max(df.times$times)+breaks_size, by=breaks_size)
breaks
breaks = round2any(breaks, roundTo)
x.names <- cut(x = df.times$times, breaks = breaks, include.lowest = T)
breaks
breaks_size
breaks
max(breaks)
max <- max(breaks)
df.times$times <- round(df.times$times, digits = 4)
x.var = "method"
y.var = "times"
x.color = "method"
x.text = x.text
if(is.null(y.text)){
y.text = paste0("Time (",attr(lst_times[["total"]], "units"),")")
}
df.times$method <- factor(df.times$method, levels = df.times$method)
ggp_time <- ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = seq(0, max, by = dist)) +
geom_text(aes_string(label = "times"), vjust = 0, nudge_y = accuracy)
ggp_time
breaks
ggp_time <- ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = breaks) +
geom_text(aes_string(label = "times"), vjust = 0, nudge_y = accuracy)
ggp_time
accuracy
roundTo
ggp_time <- ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = breaks) +
geom_text(aes_string(label = "times"), vjust = 0, nudge_y = df.times$times + accuracy)
ggp_time
accuracy
df.times$times
accuracy
accuracy <- roundTo
roundTo
ggp_time <- ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = breaks) +
geom_text(aes_string(label = "times"), vjust = 0, nudge_y = df.times$times + accuracy)
ggp_time
df.times$times
df.times$times + accuracy
breaks
ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = breaks)
df.times$times + accuracy
ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = breaks) +
geom_text(aes_string(label = "times"), vjust = 0, nudge_y = df.times$times + accuracy)
ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = breaks) +
geom_text(aes_string(label = "times"), vjust = 0, nudge_y = accuracy)
ggp_time <- ggplot(df.times, aes_string(x = x.var, y = y.var, fill = x.color)) +
geom_bar(stat="identity") +
scale_y_continuous(breaks = breaks) +
geom_text(aes_string(label = "times"), vjust = 0, nudge_y = accuracy)
ggp_time
df.times
load_all()
ggp_time <- plot_time.models(lst_models_time)
ggp_time
eval_results
lst_times <- list()
for(m in names(lst_models)){
if(class(lst_models[[m]])==pkg.env$model_class){
lst_times[[m]] <- lst_models[[m]]$time
}else if(class(lst_models[[m]][[1]])==pkg.env$model_class){
eval_sum <- lst_models[[m]][[1]]$time
if(length(lst_models[[m]])>1){
for(i in 2:length(lst_models[[m]])){
eval_sum <- eval_sum + lst_models[[m]][[i]]$time
}
lst_times[[m]] <- eval_sum
}
lst_times
total_time <- lst_times[[1]]
if(length(lst_times)>1){
for(m in 2:length(lst_times)){
total_time <- total_time + lst_times[[m]]
}
lst_times$Total <- total_time
lst_times
df.times <- do.call(rbind.data.frame, lst_times)
colnames(df.times) <- "times"
df.times$method <- names(lst_times)
rownames(df.times) <- NULL
roundTo = 0
max.breaks = 10
if(roundTo == 0){
#select the decimals of Y
if(length(grep("\\.", df.times$times))>0){
ch <- gsub("\\.", "", as.character(min(Y$time)/max.breaks))
cont = 0
for(c in 1:nchar(ch)){
if(substr(ch,c,c) == "0"){
cont = cont + 1
}else{
break
}
roundTo = 1*10^-cont
}else{
roundTo = 0.1
}
breaks_size = round2any(max(df.times$times), roundTo, f = ceiling) / max.breaks
breaks = seq(0, max(df.times$times)+breaks_size, by=breaks_size)
accuracy <- roundTo
max <- max(breaks)
df.times$times <- round(df.times$times, digits = 4)
x.var = "method"
y.var = "times"
x.color = "method"
x.text = x.text
if(is.null(y.text)){
y.text = paste0("Time (",attr(lst_times[["total"]], "units"),")")
}
df.times$method <- factor(df.times$method, levels = df.times$method)
df.times
eval_results$time
lst_models_time <- list(coxen_model,
plsicox_model,
splsdrcox_model,
splsdrcox_mo_model,
splsdacox_mo_model,
eval_results)
ggp_time <- plot_time.models(lst_models_time)
ggp_time
lst_forest_plot <- purrr::map(lst_models, ~survminer::ggforest(.$survival_model$fit,
data = .$survival_model$fit$model))
lst_forest_plot$`SPLS-DRCOX`
ggp_time
lst_forest_plot$`sPLS-DRCOX`
lst_forest_plot$attr(model, "model")
attr(model, "model")
model <- splsdacox_mo_model
attr(model, "model")
pkg.env$model_class
pkg.env
pkg.env$all_methods
attr(model, "model") %in% pkg.env$all_methods
stop(paste0("Model must be one of the following HDcox models: ", paste0(pkg.env$all_methods, collapse = ", ")))
?survminer::ggforest
load-all()
load_all()
lst_forest_plot <- plot_forest.list(lst_models)
devtools::load_all(".")
lst_forest_plot <- plot_forest.list(lst_models)
lst_forest_plot <- plot_forest(lst_models$`COX-EN`)
devtools::load_all(".")
lst_forest_plot <- plot_forest.list(lst_models)
lst_forest_plot <- plot_forest(lst_models$`COX-EN`)
lst_forest_plot
lst_forest_plot <- plot_forest.list(lst_models)
devtools::load_all(".")
lst_forest_plot <- plot_forest.list(lst_models)
attr(model, "model")
!attr(model, "model") %in% pkg.env$all_methods
lst_models
lst_forest_plot <- plot_forest.list(lst_models[1])
title = "Hazard Ratio"
cpositions = c(0.02, 0.22, 0.4)
fontsize = 0.7
refLabel = "reference"
noDigits = 2
plot_forest(model = lst_models$`COX-EN`$survival_model$fit,
title = title, cpositions = cpositions,
fontsize = fontsize, refLabel = refLabel, noDigits = noDigits)
lst_forest_plot <- purrr::map(lst_models, ~plot_forest(model = .,
title = title, cpositions = cpositions,
fontsize = fontsize, refLabel = refLabel, noDigits = noDigits))
lst_forest_plot
title
lst_models$`COX-EN`$convergence_issue
pkg.env$cox
pkg.env$sb.splsdrcox
devtools::load_all(".")
coxen_model <- coxEN(X = X_train, Y = Y_train,
EN.alpha = 0, #cv.coxen_res$opt.EN.alpha
max.variables = 6, #cv.coxen_res$opt.nvar
x.center = T, x.scale = F,
y.center = F, y.scale = F,
remove_near_zero_variance = T, remove_zero_variance = F, toKeep.zv = NULL,
remove_non_significant = F, alpha = 0.05,
MIN_EPV = 5, returnData = T, verbose = F)
coxen_model
coxen_model <- coxEN(X = X_train, Y = Y_train,
EN.alpha = 0, #cv.coxen_res$opt.EN.alpha
max.variables = 8, #cv.coxen_res$opt.nvar
x.center = T, x.scale = F,
y.center = F, y.scale = F,
remove_near_zero_variance = T, remove_zero_variance = F, toKeep.zv = NULL,
remove_non_significant = T, alpha = 0.05,
MIN_EPV = 5, returnData = T, verbose = F)
coxen_model
coxen_model$class
plsicox_model <- plsicox(X = X_train, Y = Y_train,
n.comp = 1, #n.comp = cv.plsicox_res$opt.comp
x.center = T, x.scale = F,
y.center = F, y.scale = F,
remove_near_zero_variance = T, remove_zero_variance = F, toKeep.zv = NULL,
tol = 500,
MIN_EPV = 5, returnData = T, verbose = F)
plsicox_model
plsicox_model$time
plsicox_model$class
splsdrcox_model <- splsdrcox(X = X_train, Y = Y_train,
n.comp = 1, eta = 0, #n.comp = cv.splsdrcox_res$opt.comp, eta = cv.splsdrcox_res$opt.eta
x.center = T, x.scale = F,
y.center = F, y.scale = F,
remove_near_zero_variance = T, remove_zero_variance = F, toKeep.zv = NULL,
MIN_EPV = 5, returnData = T, verbose = F)
splsdrcox_model
splsdrcox_mo_model <- splsdrcox_mixOmics(X = X_train, Y = Y_train,
n.comp = 1, vector = 500,
x.center = T, x.scale = F,
y.center = F, y.scale = F,
remove_near_zero_variance = T, remove_zero_variance = F, toKeep.zv = NULL,
MIN_NVAR = 10, MAX_NVAR = 1000, n.cut_points = 5,
MIN_AUC_INCREASE = 0.01,
EVAL_METHOD = "AUC", pred.method = "cenROC", max.iter = 200,
MIN_EPV = 5, returnData = T, verbose = F)
splsdrcox_mo_model
splsdacox_mo_model <- splsdacox_mixOmics(X = X_train, Y = Y_train,
n.comp = 2, vector = 500,
x.center = T, x.scale = F,
y.center = F, y.scale = F,
remove_near_zero_variance = T, remove_zero_variance = F, toKeep.zv = NULL,
MIN_NVAR = 10, MAX_NVAR = 1000, n.cut_points = 5,
MIN_AUC_INCREASE = 0.01,
EVAL_METHOD = "AUC", pred.method = "cenROC", max.iter = 200,
MIN_EPV = 5, returnData = T, verbose = F)
splsdacox_mo_model
lst_models <- list("COX-EN" = coxen_model,
"PLS-ICOX" = plsicox_model,
"sPLS-DRCOX" = splsdrcox_model,
"sPLS-DRCOX-MixOmics" = splsdrcox_mo_model,
"sPLS-DACOX" = splsdacox_mo_model)
eval_results <- eval_models4.0(lst_models = lst_models,
X_test = X_test, Y_test = Y_test,
pred.method = "cenROC",
pred.attr = "mean",
times = seq(1,4,0.5), max_time_points = 15,
PARALLEL = F)
# lst_evaluators <- c(cenROC = "cenROC",
#                     risksetROC = "risksetROC")
#
# eval_results <- purrr::map(lst_evaluators, ~eval_models4.0(lst_models = lst_models,
#                                                            X_test = X_test, Y_test = Y_test,
#                                                            pred.method = .,
#                                                            pred.attr = "mean",
#                                                            times = seq(1,4,0.5), max_time_points = 15,
#                                                            PARALLEL = F))
eval_results
#eval_results$cenROC
lst_eval_results <- plot_evaluation(eval_results)
#lst_eval_results <- plot_evaluation.list(eval_results)
lst_models_time <- list(coxen_model,
plsicox_model,
splsdrcox_model,
splsdrcox_mo_model,
splsdacox_mo_model,
eval_results)
ggp_time <- plot_time.models(lst_models_time)
ggp_time
lst_forest_plot <- plot_forest.list(lst_models[1])
devtools::load_all(".")
lst_forest_plot <- plot_forest.list(lst_models)
lst_forest_plot$`sPLS-DRCOX`
lst_forest_plot <- plot_forest.list(lst_models, noDigits = 3)
lst_forest_plot$`sPLS-DRCOX`
density.plots.lp <- plot_cox.event.list(lst_models, type = "lp")
density.plots.lp$`sPLS-DRCOX`$plot.density
density.plots.lp$`sPLS-DRCOX`$plot.histogram
lst_ph_ggplot <- plot_proportionalHazard.list(lst_models)
lst_ph_ggplot$`sPLS-DRCOX`
lst_eval_results$lst_plots$lineplot.mean
lst_eval_results$lst_plot_comparisons$t.test
# lst_eval_results$cenROC$lst_plots$lineplot.mean
# lst_eval_results$cenROC$lst_plot_comparisons$t.test
lst_eval_results$lst_plots$lineplot.mean
lst_models <- list("COX-EN" = coxen_model,
"PLS-ICOX" = plsicox_model,
"sPLS-DRCOX" = splsdrcox_model,
"sPLS-DRCOX-MixOmics" = splsdrcox_mo_model,
"sPLS-DACOX" = splsdacox_mo_model)
eval_results <- eval_models4.0(lst_models = lst_models,
X_test = X_test, Y_test = Y_test,
pred.method = "cenROC",
pred.attr = "mean",
times = seq(1,4,0.5), max_time_points = 15,
PARALLEL = F)
# lst_evaluators <- c(cenROC = "cenROC",
#                     risksetROC = "risksetROC")
#
# eval_results <- purrr::map(lst_evaluators, ~eval_models4.0(lst_models = lst_models,
#                                                            X_test = X_test, Y_test = Y_test,
#                                                            pred.method = .,
#                                                            pred.attr = "mean",
#                                                            times = seq(1,4,0.5), max_time_points = 15,
#                                                            PARALLEL = F))
eval_results
#eval_results$cenROC
?plot_evaluation
lst_eval_results
lst_eval_results$lst_plots$lineplot
lst_eval_results$lst_plot_comparisons$anova
lst_eval_results$lst_plots$lineplot.mean
lst_eval_results$lst_plot_comparisons$anova
# lst_eval_results$cenROC$lst_plots$lineplot.mean
# lst_eval_results$cenROC$lst_plot_comparisons$t.test
lst_eval_results$lst_plots$lineplot
lst_eval_results$lst_plot_comparisons$t.test
# lst_eval_results$cenROC$lst_plots$lineplot.mean
# lst_eval_results$cenROC$lst_plot_comparisons$t.test
lst_eval_results$lst_plots$lineplot
lst_eval_results$lst_plot_comparisons$anova
# lst_eval_results$cenROC$lst_plots$lineplot.mean
# lst_eval_results$cenROC$lst_plot_comparisons$t.test
load_all()
check()
lst_models <- list("COX-EN" = coxen_model,
"PLS-ICOX" = plsicox_model,
"sPLS-DRCOX" = splsdrcox_model,
"sPLS-DRCOX-MixOmics" = splsdrcox_mo_model,
"sPLS-DACOX" = splsdacox_mo_model)
lst_models <- list("COX-EN" = coxen_model,
"PLS-ICOX" = plsicox_model,
"sPLS-DRCOX" = splsdrcox_model,
"sPLS-DRCOX-MixOmics" = splsdrcox_mo_model,
"sPLS-DACOX-MixOmics" = splsdacox_mo_model)
eval_results <- eval_models4.0(lst_models = lst_models,
X_test = X_test, Y_test = Y_test,
pred.method = "cenROC",
pred.attr = "mean",
times = seq(1,4,0.5), max_time_points = 15,
PARALLEL = F)
# lst_evaluators <- c(cenROC = "cenROC",
#                     risksetROC = "risksetROC")
#
# eval_results <- purrr::map(lst_evaluators, ~eval_models4.0(lst_models = lst_models,
#                                                            X_test = X_test, Y_test = Y_test,
#                                                            pred.method = .,
#                                                            pred.attr = "mean",
#                                                            times = seq(1,4,0.5), max_time_points = 15,
#                                                            PARALLEL = F))
lst_forest_plot <- plot_forest.list(lst_models)
lst_forest_plot$`sPLS-DACOX-MixOmics`
density.plots.lp <- plot_cox.event.list(lst_models, type = "lp")
density.plots.lp$`sPLS-DACOX-MixOmics`$plot.density
density.plots.lp$`sPLS-DACOX-MixOmics`$plot.histogram
?HDcox::plot_cox.event.list
?HDcox::plot_cox.event.list()
?HDcox::plot_cox.event()
?coxph
?predict.coxph
lst_ph_ggplot <- plot_proportionalHazard.list(lst_models)
lst_ph_ggplot$`sPLS-DACOX-MixOmics`
devtools::load_all(".")
check()
devtools::load_all(".")
check()
install()
devtools::load_all(".")
install()
